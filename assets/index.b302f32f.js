var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,n=(t,n)=>{for(var i in n||(n={}))a.call(n,i)&&o(t,i,n[i]);if(e)for(var i of e(n))s.call(n,i)&&o(t,i,n[i]);return t};import{p as i,a as r,r as l,o as c,c as h,b as d,d as m,F as u,e as p,n as g,t as f,f as b,D as y,i as v,w,g as I,h as D,j as S,k as x,l as T,m as k}from"./vendor.a1d83f4c.js";const C={name:"App"};i("data-v-7ba5bd90");const M={class:"app-container"};r(),C.render=function(t,e,a,s,o,n){const i=l("router-view");return c(),h("div",M,[d(i)])},C.__scopeId="data-v-7ba5bd90";const L={name:"HomeSideBar",data:()=>({sidebarOptions:[{label:"Visualization",icon:"el-icon-s-data"},{label:"Settings",icon:"el-icon-s-tools"}],top:"50px",currentIndex:0}),methods:{changeoptions(t,e){this.top=50+80*e+"px",this.currentIndex=e,this.$router.push("/"+t.label)}}};i("data-v-4703fc00");const E={class:"homesidebar-container"},O={class:"homesidebar-options"},N=["onClick"],F={class:"options-item-label"},R=m("div",{class:"homesidebar-footer"},[m("span",{class:"widget-name"},"LUCK")],-1);r(),L.render=function(t,e,a,s,o,n){return c(),h("div",E,[m("div",O,[(c(!0),h(u,null,p(o.sidebarOptions,((t,e)=>(c(),h("div",{class:g(["options-item",e===o.currentIndex?"selectedoptions":""]),onClick:a=>n.changeoptions(t,e),key:t.label},[m("i",{class:g(["options-item-class",t.icon])},null,2),m("span",F,f(t.label),1)],10,N)))),128))]),m("div",{class:"slider",style:b({top:o.top})},null,4),R])},L.__scopeId="data-v-4703fc00";const $={name:"Home",data:()=>({}),components:{HomeSideBar:L},mounted(){},methods:{}};i("data-v-8dc7cce2");const H={class:"home-container"},_={class:"home-sidebar-container"},W={class:"home-content-container"};r(),$.render=function(t,e,a,s,o,n){const i=l("HomeSideBar"),r=l("router-view");return c(),h("div",H,[m("div",_,[d(i)]),m("div",W,[d(r)])])},$.__scopeId="data-v-8dc7cce2";const A=n({env:"prod",mock:!1,namespace:"luckept"},{dev:{baseURL:"http://127.0.0.1:6806/api",mockURL:"/"},prod:{baseURL:"http://127.0.0.1:6806/api",mockURL:"/"}}.prod),z=y.create({baseURL:A.baseURL,timeout:8e3});function U(t){return t.method=t.method||"get","get"===t.method.toLowerCase()&&(t.params=t.data),"prod"===A.env?z.defaults.baseURL=A.baseURL:z.defaults.baseURL=A.mock?A.mockURL:A.baseURL,z(t)}function P(t){return U({url:"/query/sql",method:"post",data:{stmt:t}})}function B(t){if(t.length<=1)return t;for(var e=Math.floor(t.length/2),a=t.splice(e,1)[0],s=[],o=[],n=0;n<t.length;n++)t[n]<a?s.push(t[n]):o.push(t[n]);return B(s).concat([a],B(o))}z.interceptors.request.use((t=>{const e=t.headers;return e.Authorization&&(e.Authorization="Bearer mockToken"),t})),z.interceptors.response.use((t=>{const{code:e,data:a,msg:s}=t.data;if(0===e)return a})),["get","post","put","delete","patch"].forEach((t=>{U[t]=(e,a,s)=>U(n({url:e,data:a,method:t},s))}));const V=window.localStorage;var j={getStorage:()=>JSON.parse(V.getItem(A.namespace)||"{}"),setStorage(t){t=JSON.stringify(t),V.setItem(A.namespace,t)},setItem(t,e){const a=this.getStorage();a[t]=e,this.setStorage(a)},getItem(t){return this.getStorage()[t]},clearItem(t){const e=this.getStorage();delete e[t],this.setStorage(e)},clearAll(){V.clear()}};const q={name:"HeatMap",data:()=>({myChart:null}),props:{range:String,hmwidth:Number,hmheight:Number},data:()=>({max:-1,year:"",formatedData:null,threshold:3,dataLoadingThreshold:50,colorConfig:[{color:"#9be9a890"},{color:"#9be9a8"},{color:"#40c463"},{color:"#30a14e"},{color:"#216e39"},{color:"#0f430a"}]}),watch:{range:{handler(t){this.year=(t.length>0?t:(new Date).getFullYear()).toString(),this.completeWorkflow()},immediate:!0}},methods:{async completeWorkflow(){const t=await this.getAllNoteDatas();let e=this.optimization(t);if(j.setItem("noteDatas",t),e){const{formatedData:e,max:a}=this.formatData(t);this.max=a,this.initEcharts(e),j.setItem("formatedData",e),j.setItem("max",a),j.setItem("year",this.year),this.$emit("updInfo")}else{this.max=j.getItem("max");let t=j.getItem("formatedData");this.initEcharts(t),this.$emit("updInfo")}},optimization(t){const e=j.getItem("noteDatas")||{},a=j.getItem("year");return!(!a||a===this.year)||(!(e.length>0)||(e.length!==t.length||e[e.length-1].hash!==t[t.length-1].hash))},async getAllNoteDatas(){const t=[];let e=(await P("SELECT count(*) from blocks WHERE type='d'"))[0]["count(*)"];const a=Math.ceil(e/this.dataLoadingThreshold);for(let s=0;s<a;s++){const e=`SELECT created From blocks WHERE type='d' limit ${this.dataLoadingThreshold} OFFSET ${this.dataLoadingThreshold*s}`;t.push(...await P(e))}return t},formatData(t){const e={};for(let o of t)o=this.handlingDtFunctions(o),e[o]?e[o]+=1:e[o]=1;const a={};for(let o in e)a[o.substring(0,4)]||(a[o.substring(0,4)]=[]),a[o.substring(0,4)].push([o,e[o]]);const s=[];for(let o in a)s.push(o);return j.setItem("yearselection",s),this.formatedData=a,{formatedData:{[this.year]:a[this.year]},max:this.filterMaximum(a[this.year])}},handlingDtFunctions({created:t}){let e=t.substring(0,8);return`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`},filterMaximum(t){const e=[];for(let o in t)e.push(t[o][1]);const a=B(e);let s=a[a.length-1];return s%10!=0&&(s=10*Math.floor(s/10+1)),s},heatMapClrConfiguration(t){let e=this.colorConfig;const a=this.threshold;return e=e.map(((t,s)=>s!==e.length-1?{min:a*s,max:a*(s+1),color:t.color}:{min:this.threshold*e.length,color:e[e.length-1].color})),e=[{max:1,color:"#fff"},...e],e},initEcharts(t){const e=document.getElementById("heatmap-echarts-container");this.myChart||(this.myChart=v(e));const a={tooltip:{formatter:"{c0}"},visualMap:{min:0,max:this.max,type:"piecewise",pieces:this.heatMapClrConfiguration(this.max),itemHeight:10,orient:"horizontal",left:"center",top:1e10},calendar:{cellSize:10,top:40,left:40,right:20,bottom:20,range:this.year,itemStyle:{borderWidth:.5},yearLabel:{show:!1}},series:{type:"heatmap",coordinateSystem:"calendar",data:t[this.year]}};a&&this.myChart.setOption(a)}}};i("data-v-77c7d3ef");const Y=[m("div",{id:"heatmap-echarts-container"},null,-1)];r(),q.render=function(t,e,a,s,o,n){return c(),h("div",{class:"heatmap-container",style:b({width:a.hmwidth+"px",height:a.hmheight+"px"})},Y,4)},q.__scopeId="data-v-77c7d3ef";const J={name:"HeatMapCtrl",data:()=>({range:"",notesNum:0,yearselection:"",yearselectionoptions:[],year:""}),props:{hmcwidth:Number,hmcheight:Number,props:String,insertyear:String},components:{HeatMap:q},watch:{insertyear:{handler(t){void 0!==t?(console.log(t),this.year=(t.length>0?t:(new Date).getFullYear()).toString()):(this.year=(new Date).getFullYear().toString(),this.yearselection=this.year)},immediate:!0}},methods:{updInfo(){const t=j.getItem("formatedData");let e=j.getItem("year");this.range=e,this.notesNum=this.totNumOfArticles(t[e]);const a=j.getItem("yearselection");this.yearselectionoptions=a.map((t=>({label:t,value:t})))},totNumOfArticles(t){let e=0;for(let a of t)e+=a[1];return e},handleyearchange(t){this.year=t}}};i("data-v-04556d0c");const G={class:"heatmapctrl-header"},K={class:"heatmapctrl-header-info"},Q={class:"heatmapctrl-header-yearselection"};r(),J.render=function(t,e,a,s,o,n){const i=l("el-option"),r=l("el-select"),g=l("HeatMap");return c(),h("div",{class:"heatmapctrl-container",style:b({width:a.hmcwidth+"px",height:a.hmcheight+50+"px"})},[m("div",G,[m("div",K,f(o.notesNum)+" articles in "+f(o.range),1),m("div",Q,[d(r,{modelValue:o.yearselection,"onUpdate:modelValue":e[0]||(e[0]=t=>o.yearselection=t),placeholder:"请选择",onChange:n.handleyearchange},{default:w((()=>[(c(!0),h(u,null,p(o.yearselectionoptions,(t=>(c(),I(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])]),d(g,{class:"heatmap-container",range:o.year,hmwidth:a.hmcwidth,hmheight:a.hmcheight,onUpdInfo:n.updInfo},null,8,["range","hmwidth","hmheight","onUpdInfo"])],4)},J.__scopeId="data-v-04556d0c";const X={name:"PieChart",props:{pcwidth:Number,pcheight:Number},data:()=>({myChart:null,totalNums:0,dolitData:null,dataLoadingThreshold:50}),mounted(){this.completeWorkflow()},methods:{async completeWorkflow(){const t=j.getItem("noteDatas")||await this.getAllNoteDatas();this.totalNums=t.length;const e=this.formatData(t);this.initPieChart(e)},async getAllNoteDatas(){const t=[];let e=(await P("SELECT count(*) from blocks WHERE type='d'"))[0]["count(*)"];const a=Math.ceil(e/this.dataLoadingThreshold);for(let s=0;s<a;s++){const e=`SELECT created From blocks WHERE type='d' limit ${this.dataLoadingThreshold} OFFSET ${this.dataLoadingThreshold*s}`;t.push(...await P(e))}return t},handlingDtFunctions({created:t}){let e=t.substring(0,8);return`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`},formatData(t){const e={};for(let s of t)s=this.handlingDtFunctions(s),e[s]?e[s]+=1:e[s]=1;let a={};for(let s in e)a[s.substring(0,4)]||(a[s.substring(0,4)]=[]),a[s.substring(0,4)].push([s,e[s]]);return a=this.pieChartDataOutput(a),[...a]},pieChartDataOutput(t){const e=[];for(let a in t){let s=0;for(let e of t[a])s+=e[1];e.push({name:a+"年",value:s,itemStyle:{width:20}})}return e},initPieChart(t){this.dolitData=this.generateData(130,35,25,"#9dd7a5");const e=document.getElementById("piechart-echartdom");this.myChart||(this.myChart=v(e));const a={title:{text:"笔记统计",subtext:this.totalNums+" 篇",textStyle:{color:"#6495ed",fontSize:40},subtextStyle:{align:"center",fontSize:24,color:[""]},x:"center",y:"40%"},tooltip:{show:!0,trigger:"item",formatter:"{b0} 共有 {c0} 篇"},grid:{left:0,right:0,top:0,bottom:0},series:[{type:"pie",clockWise:!1,center:["50%","50%"],radius:["80%","88%"],hoverAnimation:!0,tooltip:{show:!0},label:{normal:{show:!1}},labelLine:{show:!1},data:t},{name:"内圈",type:"pie",clockWise:!1,zlevel:4,silent:!0,radius:["70%","72%"],label:{normal:{show:!1}},labelLine:{normal:{show:!1}},data:this.dolitData}]};a&&this.myChart.setOption(a)},generateData(t,e,a,s){let o=[];for(var n=0;n<t;n++)n%2==0?o.push({name:(n+1).toString(),value:e,itemStyle:{normal:{color:s,borderWidth:0}}}):o.push({name:(n+1).toString(),value:a,itemStyle:{normal:{color:"rgba(0,0,0,0)",borderWidth:0}}});return o}}};i("data-v-7e424a9f");const Z={class:"piechart-container"};r(),X.render=function(t,e,a,s,o,n){return c(),h("div",Z,[m("div",{style:b({width:a.pcwidth+"px",height:a.pcheight+"px"}),id:"piechart-echartdom"},null,4)])},X.__scopeId="data-v-7e424a9f";const tt={name:"DateProgress",data:()=>({times:0,attendance:0,animationFrmDuration:60,animationInvl:0,monthlyNotes:0,attendanceRate:0,daysOfTheMm:0,autoIncreaseV:2.5,dataLoadingThreshold:50,month:0}),mounted(){this.completeWorkflow()},methods:{progressBarAnimation(){this.attendance<this.attendanceRate&&setTimeout((()=>{this.attendance=this.animationInvl*this.times,this.times+=1,this.progressBarAnimation()}),this.animationFrmDuration)},async completeWorkflow(){const t=await j.getItem("noteDatas")||await this.getAllNoteDatas(),e=this.formatData(t);this.selfgrowth(e.noteNums),this.progressBarAnimation()},selfgrowth(t){let e=1;const a=document.getElementById("autoIncrease");if(t<217){let s=setInterval((()=>{e===t&&clearInterval(s),a.innerHTML=e++}),this.autoIncreaseV)}else{let s=setInterval((()=>{e>=t&&clearInterval(s),e+=10,a.innerHTML=e>t?t:e}),0*this.autoIncreaseV)}},formatData(t){const e={};for(let r of t)r=this.handlingDtFunctions(r),e[r]?e[r]+=1:e[r]=1;let a={};for(let r in e)a[r.substring(0,4)]||(a[r.substring(0,4)]=[]),a[r.substring(0,4)].push([r,e[r]]);const s=(new Date).getFullYear();this.month=(new Date).getMonth()+1;const o=this.monthToStrMonth((new Date).getMonth()+1);this.theNumOfDaysInTheMm(o);const n=this.filterCurMmInfo(a[s],o);this.attendanceRate=n.attendanceRate;const i=(this.attendanceRate/1).toFixed(1);return this.animationInvl=i,n},filterCurMmInfo(t,e){let a=0,s=0;for(let o of t)o[0].substring(5,7)===e&&(a+=1,s+=o[1]);return{attendanceRate:(a/this.daysOfTheMm*100).toFixed(1),noteNums:s}},monthToStrMonth:t=>t<10?"0"+t:t.toString(),theNumOfDaysInTheMm(t){switch(t){case"01":this.daysOfTheMm=31;break;case"02":this.daysOfTheMm=28;break;case"03":this.daysOfTheMm=31;break;case"04":this.daysOfTheMm=30;break;case"05":this.daysOfTheMm=31;break;case"06":this.daysOfTheMm=30;break;case"07":case"08":this.daysOfTheMm=31;break;case"09":this.daysOfTheMm=30;break;case"10":case"11":case"12":this.daysOfTheMm=31}},handlingDtFunctions({created:t}){let e=t.substring(0,8);return`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`},async getAllNoteDatas(){console.log("我进来了");const t=[];let e=(await P("SELECT count(*) from blocks WHERE type='d'"))[0]["count(*)"];const a=Math.ceil(e/this.dataLoadingThreshold);for(let s=0;s<a;s++){const e=`SELECT created From blocks WHERE type='d' limit ${this.dataLoadingThreshold} OFFSET ${this.dataLoadingThreshold*s}`;t.push(...await P(e))}return t}}};i("data-v-08ac85e8");const et={class:"dateprogress-container"},at={class:"dateprogress-viewbox"},st={class:"viewbox-top"},ot={class:"viewbox-hightlight"},nt=D("月共耕耘笔记"),it=m("span",{class:"viewbox-hightlight",id:"autoIncrease"},null,-1),rt=D("篇 "),lt={class:"viewbox-bottom"},ct=m("div",{class:"viewbox-bottomtitle"},"创作出勤率",-1),ht={class:"viewbox-bottomrate"};r(),tt.render=function(t,e,a,s,o,n){const i=l("el-progress");return c(),h("div",et,[m("div",at,[m("div",st,[m("span",ot,f(o.month),1),nt,it,rt]),m("div",lt,[ct,m("div",ht,[d(i,{"text-inside":!0,"stroke-width":26,percentage:o.attendance},null,8,["percentage"])])])])])},tt.__scopeId="data-v-08ac85e8";const dt={name:"Visualization",components:{HeatMapCtrl:J,PieChart:X,DateProgress:tt}};i("data-v-b6bb290c");const mt={class:"visualization-container"},ut={class:"top-version"},pt={class:"left-pie"},gt={class:"right-date"},ft={class:"bottom-version"};r(),dt.render=function(t,e,a,s,o,n){const i=l("PieChart"),r=l("DateProgress"),u=l("HeatMapCtrl");return c(),h("div",mt,[m("div",ut,[m("div",pt,[d(i,{pcwidth:600,pcheight:325})]),m("div",gt,[d(r)])]),m("div",ft,[d(u,{hmcwidth:1e3,hmcheight:150})])])},dt.__scopeId="data-v-b6bb290c";const bt={name:"Settings"};i("data-v-53cc84dd");const yt={class:"settings-container"},vt=[m("img",{class:"undoImg",src:"/widgets/luck/Illustration/undoimg.png",alt:""},null,-1),m("div",{class:"text"},"配方合成中...",-1)];r(),bt.render=function(t,e,a,s,o,n){return c(),h("div",yt,vt)},bt.__scopeId="data-v-53cc84dd";const wt=[{name:"home",path:"/",component:$,redirect:"/visualization",children:[{name:"visualization",path:"/visualization",component:dt},{name:"settings",path:"/settings",component:bt}]}],It=S({history:x(),routes:wt});console.log("luckept: 欢迎使用我的挂件，使用过程中遇到问题请前往 Github 提交 issue！");const Dt=T(C);Dt.config.globalProperties.$request=U,Dt.config.globalProperties.$storage=j,Dt.use(It).use(k).mount("#app");
